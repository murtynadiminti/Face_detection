<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Face Registration</title>
  <!-- Face API library -->
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  <style>
    body { text-align:center; font-family:Arial; background:#eef; }
    video, canvas { border:2px solid #444; border-radius:10px; margin:10px; }
    button { margin:10px; padding:10px 20px; font-size:16px; cursor:pointer; }
    #status { font-weight:bold; margin-top:15px; }
  </style>
</head>
<body>
  <h2>üòÄ Register Your Face</h2>

  <!-- Video stream -->
  <video id="video" width="480" height="360" autoplay muted playsinline></video><br>
  <button id="captureBtn">üì∏ Capture Face</button>
  <p id="status">Loading models...</p>

  <script>
    const video = document.getElementById('video');
    const statusText = document.getElementById('status');
    let capturedDescriptor = null;

    // ‚úÖ Start camera stream
    async function startVideo() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
        video.srcObject = stream;
        statusText.textContent = "üì∑ Camera started. Position your face.";
      } catch (err) {
        statusText.textContent = "‚ùå Camera access denied or not available.";
        console.error("Camera error:", err);
      }
    }

    // ‚úÖ Load Face API models from jsDelivr
    async function loadModels() {
      const MODEL_URL = "https://cdn.jsdelivr.net/npm/face-api.js/models";
      await Promise.all([
        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),
        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)
      ]);
      statusText.textContent = "‚úÖ Models loaded. Starting camera...";
      startVideo();
    }

    loadModels();

    // ‚úÖ Capture and save face descriptor
    document.getElementById('captureBtn').onclick = async () => {
      if (!video.srcObject) {
        statusText.textContent = "‚ö†Ô∏è Camera not started yet!";
        return;
      }

      const detection = await faceapi
        .detectSingleFace(video, new faceapi.TinyFaceDetectorOptions())
        .withFaceLandmarks()
        .withFaceDescriptor();

      if (!detection) {
        statusText.textContent = "‚ö†Ô∏è No face detected. Try again!";
        return;
      }

      capturedDescriptor = Array.from(detection.descriptor); // save as array
      localStorage.setItem("registeredFace", JSON.stringify(capturedDescriptor));

      statusText.textContent = "üéâ Face registered successfully! You can now open monitor.html";
    };
  </script>
</body>
</html>

